<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disobey 2026 - Stage Schedule</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            background-size: contain;
            background-color: #000000;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Vue app will be mounted here -->
    </div>
    <script>
      const { createApp, ref, onMounted } = Vue;

      createApp({
        setup() {
          let previousImageHash = null;

          async function hashString(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
          }

          async function update_image() {
            try {
              // Fetch with cache busting to get fresh data
              let imageUrl = `venuemap.png?t=${Date.now()}`;
              const response = await fetch(imageUrl);
              const imageData = await response.text();

              // Generate hash of the image data
              const imageHash = await hashString(imageData);

              console.log("Fetched image hash:", imageHash, "Previous image hash:", previousImageHash);

              // Check if image hash is different from previous
              if (imageHash !== previousImageHash) {
                // Create object URL for the blob and update background

                document.body.style.setProperty('background-image', `url(${imageUrl})`, 'important');

                // Store current image hash for next comparison
                previousImageHash = imageHash;
                console.log("Background image updated to:", imageUrl);
              } else {
                console.log("Image unchanged, skipping update");
              }
            } catch (error) {
              console.error("Error fetching or updating image:", error);
              // Do nothing on error
            }
          }

          onMounted(() => {
            console.log("Starting, fetching image...");
            update_image();
            // Update image every 10 minutes
            setInterval(update_image, 10 * 60 * 1000);
          });

          return {
          };
        }
      }).mount('#app');
    </script>
  </body>
</html>