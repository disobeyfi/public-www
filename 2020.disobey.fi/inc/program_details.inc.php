<?php
/*-------------------------
 Timetable data
 -----------------------*/
/*-------------------------
 Day 1
 -----------------------*/

$main_day_1 = [
	['time'=>'11:30', 'length'=>'4', 'header'=>'Doors open & registration', 'name'=>'', 'url' => '' ],
	['time'=>'12:30', 'length'=>'1', 'header'=>'Opening', 'name'=>'by NotMyNick', 'url' => '' ],
	['time'=>'13:00', 'length'=>'4', 'header'=>'Shatter Reloaded: Reviving shatter attacks to escape sandboxes and evade endpoint security products', 'name'=>'Eran Zimmerman Gonen', 'url' => 'profile/shatter_reloaded' ],
	['time'=>'14:00', 'length'=>'4', 'header'=>'Freeda them all.Cracking the userspace for fun and profit', 'name'=>'by Giovanni - iGio90 - Rocca', 'url' => 'profile/cracking_the_userspace' ],
	['time'=>'15:00', 'length'=>'5', 'header'=>'KEYNOTE', 'name'=>'Mikko Hyppönen', 'classes'=>'keynote', 'url' => 'profile/keynote_hypponen' ],

	['time'=>'16:30', 'length'=>'2', 'header'=>'Hunting for malware: Picking DarkRatv2 apart', 'name'=>'by Albert Zsigovits', 'url' => 'profile/darkratv2' ],
	['time'=>'17:00', 'length'=>'4', 'header'=>'app.setAsDefaultRCEClient: Electron, scheme handlers and stealthy security patches', 'name'=>'by Juho Nurminen' , 'url' => 'profile/app_setasdefaultrceclient'],
	['time'=>'18:00', 'length'=>'4', 'header'=>'Trustworthy platforms in practice: I have a TPM, now what?', 'name'=>'by Gabriela Limonta', 'url' => 'profile/trustworthy_platforms_in_practice' ],
	['time'=>'19:00', 'length'=>'4', 'header'=>'Lets\'s get physical', 'name'=>'by Timo Hirvonen & Robert Bearsby', 'url' => 'profile/lets_get_physical' ],
	['time'=>'20:00', 'length'=>'4', 'header'=>'Privacy Threat Modeling Based on Data Lifecycle', 'name'=>'by Anne & Tuisku', 'url' => 'profile/privacy_threat_modeling' ],
	['time'=>'21:00', 'length'=>'4', 'header'=>'Game of #shells', 'name'=>'by  Taavi Sonets & Rasmus Männa', 'url' => 'profile/game_of_shells' ],
	['time'=>'22:00', 'length'=>'4', 'header'=>'NOTH1NG T0 HID3: Should we fix privacy?', 'name'=>'by Kirils', 'url' => 'profile/noth1ng_t0_hid3' ],
	['time'=>'23:00', 'length'=>'4', 'header'=>'PARTY <br>( Outside of Merikaapelihalli )', 'name'=>'', 'url' => '' ]
];

$w1_day_1 = [
	['time'=>'12:45', 'length'=>'1', 'header'=>'Badge talk', 'name'=>'by Heikki Juva', 'url' => 'profile/badgetalk' ],
	['time'=>'13:00', 'length'=>'8', 'header'=>'Surface Mount Electronics Assembly for Terrified Beginners', 'name'=>'by Kliment', 'url' => 'profile/smd_assembly' ],
	['time'=>'15:00', 'length'=>'5', 'header'=>'KEYNOTE STREAM', 'name'=>'', 'classes'=>'keynote-stream', 'url' => 'profile/keynote_hypponen'  ],
	['time'=>'16:30', 'length'=>'16', 'header'=>'Memory Forensics 101', 'name'=>'by Juho, Mika & Timo', 'url' => 'profile/memory_forensics_101' ],
	['time'=>'20:45', 'length'=>'8', 'header'=>'Leading your remediative Red Team', 'name'=>'by Jussi & Kimmo', 'url' => 'profile/leading_your_red_team' ],
];

$w2_day_1 = [
	['time'=>'12:45', 'length'=>'8', 'header'=>'Identifying attack paths with BloodHound', 'name'=>'by Niklas & Henri', 'url' => 'profile/identifying_attack_paths_with_bloodhound' ],
	['time'=>'15:00', 'length'=>'5', 'header'=>'KEYNOTE STREAM', 'name'=>'', 'classes'=>'keynote-stream', 'url' => 'profile/keynote_hypponen'  ],
	['time'=>'16:30', 'length'=>'16', 'header'=>'Fun with Logs', 'name'=>'by Liisa', 'url' => 'profile/fun_with_logs' ],
	['time'=>'20:45', 'length'=>'8', 'header'=>'fffu-ffu-ffuzzing fhe feb', 'name'=>'by Joohoi', 'url' => 'profile/fuzzing_the_feb' ]
];
//Not used
$w3_day_1 = [];

/*-------------------------
 Day 2
 -----------------------*/

$main_day_2 = [
	['time'=>'10:00', 'length'=>'4', 'header'=>'Doors open & registration', 'name'=>'' , 'url' => ''],
	['time'=>'11:00', 'length'=>'2', 'header'=>'Secure Elements and Disclosure', 'name'=>'by Michael Schloh' , 'url' => 'profile/secure_elements_and_disclosure'],
	['time'=>'11:30', 'length'=>'4', 'header'=>'Shooting ourselves in the foot with 15Gbps traffic - a DDoS primer', 'name'=>'by Markus Forsström' , 'url' => 'profile/shooting_ourselves_in_the_foot'],
	['time'=>'12:30', 'length'=>'4', 'header'=>'More Than Turbulence', 'name'=>'by Chris Kubecka', 'url' => 'profile/more_than_turbulence' ],
	['time'=>'13:30', 'length'=>'2', 'header'=>'Breaking Detection with x86 ISA Specific Malware', 'name'=>'by Chris Hernandez', 'url' => 'profile/x86_isa_specific_malware' ],
	['time'=>'14:00', 'length'=>'4', 'header'=>'KEYNOTE', 'name'=>'Jayson E Street', 'classes'=>'keynote', 'url' => 'profile/keynote_street'],
	['time'=>'15:30', 'length'=>'4', 'header'=>'We Pwn VPN: Exploiting client-side vulnerabilities in commercial VPNs', 'name'=>'Thanh Bui, Sid Rao and Markku Antikainen', 'url' => 'profile/we_pwn_vpn' ],
	['time'=>'16:30', 'length'=>'4', 'header'=>'Security Expedition in b0rkenLand - IT is still burning hard', 'name'=>'by Hetti', 'url' => 'profile/security_expedition_in_b0rkenLand' ],

	['time'=>'17:45', 'length'=>'4', 'header'=>'I\'m in your office - bypassing access control without social engineering', 'name'=>'by Antti Virtanen', 'url' => 'profile/i_m_in_your_office' ],
	['time'=>'18:45', 'length'=>'4', 'header'=>'Cybersecurity for business trips', 'name'=>'by Jarno Niemelä', 'url' => 'profile/cybersecurity_for_business_trips' ],
	['time'=>'19:45', 'length'=>'4', 'header'=>'Live Memory Attacks and Forensics', 'name'=>'by Ulf Frisk', 'url' => 'profile/live_memory_attacks' ],
	['time'=>'20:45', 'length'=>'4', 'header'=>'Paradigm shift', 'name'=>'by Antti Kurittu', 'url' => 'profile/paradigm_shift' ],
	['time'=>'21:45', 'length'=>'2', 'header'=>'Closing remarks and Awards Ceremony', 'name'=>'by NotMyNick', 'url' => '' ],
	['time'=>'22:15', 'length'=>'2', 'header'=>'DISOBEY AFTERPARTY at Biitsi.fi <br>( doors open 21:30 )', 'name'=>'', 'url' => '' ]

];

$w1_day_2 = [
	['time'=>'11:45', 'length'=>'8', 'header'=>'Basics of Penetration', 'name'=>'by Osku', 'url' => 'profile/basics_of_penetration' ],
	['time'=>'14:00', 'length'=>'4', 'header'=>'KEYNOTE STREAM', 'name'=>'', 'classes'=>'keynote-stream', 'url' => 'profile/keynote_street'],
	['time'=>'15:30', 'length'=>'8', 'header'=>'How to adapt your infosec message for different audiences', 'name'=>'by Helinä Turunen', 'url' => 'profile/adapt_your_infosec_message' ],
	['time'=>'17:45', 'length'=>'16', 'header'=>'Bad day of digital forensics analyst', 'name'=>'by Karoliina Kemppainen', 'url' => 'profile/bad_day_of_forensic_analyst' ]
];

$w2_day_2 = [
	['time'=>'11:30', 'length'=>'8', 'header'=>'Deceive yourself, become an expert in anything!', 'name'=>'by Simon "Plantprogrammer" Schliesky & Ilias "A2nkf" Morad', 'url' => 'profile/deceive_yourself' ],
	['time'=>'14:00', 'length'=>'4', 'header'=>'KEYNOTE STREAM', 'name'=>'', 'classes'=>'keynote-stream', 'url' => 'profile/keynote_street'],
	['time'=>'15:30', 'length'=>'8', 'header'=>'Weaponizing information – how to craft a credible attack pretext', 'name'=>'by Riku & Lauri', 'url' => 'profile/weaponizing_information' ],
	['time'=>'18:00', 'length'=>'12', 'header'=>'Near Practical Quantum Computing', 'name'=>'by Topias Uotila', 'url' => 'profile/near_practical_quantum_computing' ],
];
//Not in use
$w3_day_2 = [];


/*-------------------------
 Timetable output class
 -----------------------*/
class TimeTable{

	function output( $main_day_1, $w1_day_1, $w2_day_1, $w3_day_1, $day_string, $range_start){

			date_default_timezone_set("Europe/London");
			$this->range 						= range(strtotime( $range_start ),strtotime("23:45"),15*60);
			$this->time_label_slots = array_fill( 0, count( $this->range ),"" );
			$output =  $this->getColumn( $main_day_1, 4, "Main Stage", "main", "Main", $day_string );
			$output .= $this->getColumn( $w1_day_1, 	3, "Chrome Workshop", "w1", "Chrome", $day_string );
			$output .= $this->getColumn( $w2_day_1, 	3, "Neon Workshop", "w2", "Neon", $day_string );
			//$output .= $this->getColumn( $w3_day_1, 	2, "Not Gov Track", "w3", "No Gov", $day_string );
			$time_label_column = $this->getTimeLabelsColumn();

			return "<div id='timetable-day-1' class='grid-x'>{$time_label_column}{$output}{$time_label_column}</div>";
	}
	/*-------------------------
	 Time Labels
	 -----------------------*/
	function getTimeLabelsColumn(){
		$output = "";
		foreach( $this->time_label_slots as $key => $time_string ){
			$class = ( empty($time_string) )? "" : "has-time-label";
			$output .= "<div class='time-label-slot {$class}'>{$time_string}</div>";
		}
		return "<div class='timetable-column cell small-1 time-column'><div class='column-header'>TIME</div>{$output}</div>";
	}
	/*-------------------------
	 Get Single Column
	 -----------------------*/
	function getColumn( $data, $foundation_width, $column_header, $column_class, $column_shorthand, $day_string ){

		$output = "";

		foreach($this->range as $index => $time){

				//Skip by previous slot program length
				if( $skip > 0 ){ $skip--; continue; }

				//Get slot data
				$slot = $this->getSlotData( $time, $data );
				if( empty($slot) ){ $output .= "<div class='empty'></div>"; continue; }



				// Do slot markup
				$slot_classes = ( empty($slot['classes']) )? "" : $slot['classes'];
				$time_string = date("H:i",$time);
				$link_start = ( empty($slot['url']) )? "" :"<a href='{$slot['url']}'>";
				$link_end = ( empty($slot['url']) )? "" : "</a>";

				$output .= "{$link_start}<div class='height-{$slot['length']} has-content timetable-cell {$slot_classes}'>
					<div class='mobile-date'>
						<div class='mobile-day-label'>{$day_string}</div>
						{$time_string}<br>
						{$column_shorthand}
					</div>
					<div class='cell-header'>
						<h2>{$slot['header']}</h2>
						<span>{$slot['name']}</span>
					</div>
				</div>{$link_end}";

				//Add time where program starts and amount of skipped slots
				$this->time_label_slots[ $index ] = $time_string;
				$skip = $slot['length']-1;
		}

		return "<div class='timetable-column cell medium-{$foundation_width} {$column_class}'><div class='column-header'><span>{$column_header}</span></div>{$output}</div>";

	}
	/*-------------------------
	 Get single Slot
	 -----------------------*/
	function getSlotData( $time, $data ){
		foreach ( $data as $key => $value) {
			if( $time == strtotime($value['time']) ){
				return $value;
			}
		}
		return false;
	}

}


?>
<div class='schedule-list-container schedule-details text-center' >
	<h4 class="text-center" id="top">Friday 14th</h4>
	<!-- <div id='venue-map' class='medium-text-right text-center'><a href='practical.php'>See Venue map</a></div> -->
	<?php
			$timetable = new TimeTable();
			echo $timetable->output( $main_day_1, $w1_day_1, $w2_day_1, $w3_day_1, "Fri", "11:30" );
	?>
</div>

<!-- Program day 1 -->


<!-- Program day 2 -->
<div class='schedule-list-container schedule-details text-center' >
	<h4 class="text-center">Saturday 15th</h4>
	<?php
			echo $timetable->output( $main_day_2, $w1_day_2, $w2_day_2, $w3_day_2, "Sat", "10:00" );
	?>
</div>

<script>
$("td.time").each( function(){
	$(this).html(  $(this).html().replace("-","<span class='hide-for-small-only'> - </span><span class='show-for-small-only'><br></span>") )
})
</script>
